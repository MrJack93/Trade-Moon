# TradeX

**TradeX** — это современный веб-бот для автоматизации крипто-торговли на таких популярных биржах, как **Binance** и **Bybit**. Он интегрируется с **TradingView webhooks** и уведомлениями по электронной почте, что позволяет выполнять сделки в реальном времени на основе пользовательских сигналов. Система предоставляет защищённую и удобную панель управления для наблюдения за открытыми позициями, ожидающими ордерами и управления сделками.

**Ключевые возможности:**
- Поддержка нескольких бирж (Bybit, Binance).
- Защищённая аутентификация и PIN‑защита для выполнения сделок.
- Мониторинг в реальном времени открытых позиций и ожидающих ордеров.
- Поддержка получения сигналов как через webhook, так и по электронной почте.
- Контейнеризованное развёртывание через Docker.

---

## Содержание
- [Функции](#функции)
- [Скриншоты](#скриншоты)
- [Поддерживаемые биржи](#поддерживаемые-биржи)
- [Режимы работы](#режимы-работы)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Использование](#использование)
- [Запуск TradeX в Docker](#запуск-tradex-в-docker)
- [Запуск TradeX как сервиса](#запуск-tradex-как-сервиса)
  - [С помощью Supervisord](#запуск-с-помощью-supervisord)
  - [С помощью Systemd](#запуск-с-помощью-systemd)
- [Использование Nginx как прокси для Webhooks](#использование-nginx-как-прокси-для-webhooks)
- [Устранение неполадок](#устранение-неполадок)
- [Рекомендации по безопасности](#рекомендации-по-безопасности)
- [Известные проблемы](#известные-проблемы)
- [Лицензия](#лицензия)
- [Поддержать проект](#поддержать-проект)

---

## Функции
- **Поддержка нескольких бирж**: интеграция с **Bybit** и **Binance Futures**.
- **Управление ордерами**: отмена позиций и ордеров прямо из панели управления.
- **Мониторинг в реальном времени**: отображение всех активных и ожидающих ордеров в удобном интерфейсе.
- **Закрыть все позиции**: быстрое закрытие всех открытых позиций одной кнопкой.
- **Получение сигналов**: поддержка сигналов как через **webhook**, так и по **email**.
- **Аутентификация**: защищённая панель с паролем.
- **PIN‑защита**: дополнительный уровень безопасности — для выполнения ордеров требуется PIN для webhook/почты.
- **Логирование**: подробные логи для отладки и мониторинга.

---

## Скриншоты
![App_Screenshot](https://github.com/user-attachments/assets/79bd5123-c81c-49b1-9e8e-5d064698f20d)

---

## Поддерживаемые биржи

<img src="https://github.com/user-attachments/assets/ce33b5e5-0d4d-411e-9821-50e12414a7f2" alt="image" width="100px">   
<img src="https://github.com/user-attachments/assets/ab0da857-493e-4824-ab3e-0d87fb05a0b0" alt="image" width="100px">

- **Bybit Futures**
- **Binance Futures** (полностью не протестировано)
- Дополнительные биржи можно добавить по запросу или в PR.

---

## Режимы работы

TradeX поддерживает два режима приёма торговых сигналов: **Webhook Mode** и **Email Mode**. Эти режимы дают гибкость в зависимости от инфраструктуры и предпочтений. Режим настраивается через переменную окружения `MODE` в файле `.env` (`MODE=webhook`, `MODE=email` или `MODE=both`).

---

### 1. Webhook Mode

**Webhook Mode** позволяет TradeX принимать торговые сигналы в реальном времени через HTTP POST-запросы. Этот режим подходит для пользователей с публичным IP или доменом.

#### Основные особенности:
- **Выполнение в реальном времени**: сигналы обрабатываются сразу после получения.
- **Низкая задержка**: минимальная задержка между генерацией сигнала (например, в TradingView) и исполнением ордера.
- **Защита**: требуется настраиваемый PIN (`WEBHOOK_PIN`) для авторизации сигналов.
- **Интеграция с TradingView**: простая интеграция через webhooks.

#### Требования:
- Публичный IP-адрес или домен, указывающий на сервер.
- Стабильное подключение к интернету.
- Открытые порты `80` или `443` (или проксирование через Nginx/Apache).
- Опционально: SSL/TLS сертификат для HTTPS.

#### Сценарий использования:
Если у вас есть выделённый сервер или VPS с публичным IP и нужна максимальная скорость исполнения — выбирайте **Webhook Mode**. Он подходит трейдерам, которым важна быстрая реакция на рыночные события.

#### Важно:
TradingView webhooks не гарантируют доставку без задержек или ошибок. Ограничения включают:
- **Задержки доставки**: возможны из‑за высокой нагрузки.
- **Требования к скорости ответа**: TradingView ожидает быстрый ответ (обычно миллисекунды). Если приложение отвечает долго, TradingView может повторить запрос или пометить его как неуспешный.
- **Нет 100% гарантий доставки**.

Рассмотрите использование **Email Mode** как резервного варианта или включите **Dual Mode** (`MODE=both`) для надёжности.

---

### 2. Email Mode

**Email Mode** позволяет TradeX обрабатывать торговые сигналы, присылаемые по электронной почте. Этот режим удобен, если у вас нет публичного IP или вы предпочитаете не открывать порты.

#### Основные особенности:
- **Не требуется публичный IP**: всё работает через почту — не нужно пробрасывать порты.
- **Устойчивость к офлайну**: если соединение временно пропадает, письма будут ждать в ящике и обработаются позже.
- **Простая настройка**: достаточно настроить IMAP и отправлять сигналы по почте.
- **Гибкий формат сигналов**: сигналы можно помещать в subject письма в виде JSON.

#### Требования:
- Почтовый ящик с доступом по IMAP.
- Корректно отформатированные сигналы в subject (JSON).

#### Сценарий использования:
Если у вас нет публичного IP или стабильного соединения — **Email Mode** будет оптимальным вариантом. Также подходит как резерв в случае проблем с webhook.

---

### 3. Dual Mode (оба режима)

Для максимальной надёжности TradeX поддерживает **Dual Mode** (`MODE=both`), когда одновременно слушаются сигналы и по webhook, и по email.

#### Преимущества:
- **Универсальность**: сочетание скорости webhook и надёжности email.
- **Гибкость**: вебхуки для срочных сигналов, почта для гарантированных доставок.

#### Пример использования:
Трейдер использует **TradingView webhooks** для срочных сигналов во время активной торговли, а email — для ночных или менее срочных операций. Включив оба режима, можно минимизировать риск пропуска сигналов.

#### Важно:
При Dual Mode настройте отправку сигналов в TradingView аккуратно, чтобы избежать дублей:
- **Выберите «Send Email» только для менее срочных сигналов**.
- **Выберите «Webhook URL» только для срочных сигналов**.
- **Не включайте оба одновременно** для одного и того же сигнала — это приведёт к двойной отправке и потенциально к дублям ордеров.

TradeX в текущей версии не содержит механизма дедупликации, поэтому настройка на стороне TradingView остаётся на ответственности пользователя.

---

### Как настроить режим

Установите `MODE` в вашем `.env`:
- `MODE=webhook` — только webhook.
- `MODE=email` — только email.
- `MODE=both` — оба режима одновременно.

---

## Установка

### Требования
- Python 3.8 или выше
- Менеджер пакетов `pip`
- API‑ключи для поддерживаемых бирж (Bybit, Binance)
- Docker (опционально)

### Шаги
1. **Клонировать репозиторий**:
   ```bash
   git clone https://github.com/Sentello/tradex.git
   cd tradex
   ```

2. **Создать виртуальное окружение** (рекомендуется):
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **Установить зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Настроить переменные окружения**:
   - Переименуйте `.env.example` в `.env` или создайте новый `.env`.
   - Добавьте API‑ключи бирж, пароль для панели, PIN для webhook и другие параметры.

5. **Запустить приложение локально**:
   ```bash
   python main.py
   ```

6. **Открыть панель управления**:
   - В браузере перейдите на `http://localhost:5000`.

---

## Конфигурация

В `.env` необходимо задать следующие переменные:

| Переменная             | Описание                                                                  |
|------------------------|---------------------------------------------------------------------------|
| `DASHBOARD_PASSWORD`   | Пароль для доступа к панели.                                              |
| `WEBHOOK_PIN`          | PIN для защиты webhook сигналов.                                          |
| `BYBIT_API_KEY`        | API ключ Bybit.                                                           |
| `BYBIT_API_SECRET`     | Секретный ключ Bybit.                                                     |
| `BINANCE_API_KEY`      | API ключ Binance.                                                         |
| `BINANCE_API_SECRET`   | Секретный ключ Binance.                                                   |
| `MODE`                 | Режим приёма сигналов: `"webhook"`, `"email"` или `"both"`.               |
| `IMAP_SERVER`          | Адрес IMAP сервера (например, `imap.gmail.com`).                          |
| `IMAP_PORT`            | Порт IMAP (обычно `993` для SSL).                                         |
| `IMAP_EMAIL`           | Почтовый адрес для приёма сигналов.                                       |
| `IMAP_PASSWORD`        | Пароль от почтового аккаунта.                                             |


---

## Использование

### Пример webhook (тестирование с `curl`)

Слушатель webhook работает на порту `5005`. Примеры запросов для тестирования:

#### Рыночный ордер (market)
```bash
curl -X POST http://localhost:5005/webhook \
-H "Content-Type: application/json" \
-d '{
    "PIN": "123456",
    "EXCHANGE": "bybit",
    "SYMBOL": "BTCUSDT",
    "SIDE": "buy",
    "ORDER_TYPE": "market",
    "QUANTITY": 0.01
}'
```

#### Лимитный ордер (limit)
```bash
curl -X POST http://localhost:5005/webhook \
-H "Content-Type: application/json" \
-d '{
    "PIN": "123456",
    "EXCHANGE": "binance",
    "SYMBOL": "ETHUSDT",
    "SIDE": "sell",
    "ORDER_TYPE": "limit",
    "QUANTITY": 0.5,
    "PRICE": 2000.50
}'
```

### Интеграция с TradingView
При настройке webhook в TradingView используйте шаблоны и правильно экранируйте плейсхолдеры:
```json
{
    "PIN": "123456",
    "EXCHANGE": "bybit",
    "SYMBOL": "BTCUSDT",
    "SIDE": "{{strategy.order.action}}",
    "ORDER_TYPE": "market",
    "QUANTITY": "{{strategy.order.contracts}}"
}
```

**Примечание**: TradingView отправляет webhooks на порты `80` или `443`. Рекомендуется использовать Nginx как обратный прокси, чтобы перенаправлять запросы на порт `5005`.

---

## Запуск TradeX в Docker

1. Сборка и запуск:
   ```bash
   docker-compose build --no-cache
   docker-compose up --build -d
   ```
   или используйте `build_and_run.sh`.

2. Проверить статусы контейнеров:
   ```bash
   docker ps | grep tradex
   ```

3. Просмотр логов:
   ```bash
   docker-compose logs -f
   ```

4. Остановить приложение:
   ```bash
   docker-compose down
   ```

---

## Запуск TradeX как сервиса

Это руководство описывает пошаговую настройку TradeX как фонового сервиса с помощью **Supervisor** (`supervisord`) или **systemd**. Эти инструменты гарантируют стабильную работу приложения и автоматический перезапуск в случае падения.

### Запуск с помощью Supervisord

`supervisord` — это система управления процессами, которая позволяет запускать и контролировать несколько процессов как фоновые сервисы.

#### Требования
1. Установите `supervisor`:
   ```bash
   sudo apt update
   sudo apt install supervisor
   ```
2. Убедитесь, что в каталоге проекта есть файл `supervisord.conf`.

#### Шаги
1. **Скопируйте `supervisord.conf`** (если не в Docker):
   ```bash
   sudo cp supervisord.conf /etc/supervisor/conf.d/tradex.conf
   ```

2. **Перезагрузите конфигурацию Supervisor**:
   ```bash
   sudo supervisorctl reread
   sudo supervisorctl update
   ```

3. **Запустите сервисы**:
   ```bash
   sudo supervisorctl start tradex:*
   ```

4. **Проверка статуса**:
   ```bash
   sudo supervisorctl status
   ```

### Запуск с помощью Systemd

`systemd` — менеджер сервисов для Linux, позволяющий управлять службами, которые автоматически стартуют при загрузке системы.

#### Требования
1. Убедитесь, что Python окружение и зависимости установлены.
2. Если вы используете виртуальное окружение, запомните путь до него.
3. Необходимы права `sudo`.

#### Шаги
1. **Создайте unit-файлы** в `/etc/systemd/system/`.

2. **Unit для `dashboard_app`** (`dashboard_app.service`):
   ```ini
   [Unit]
   Description=Gunicorn instance to serve TradeX Dashboard
   After=network.target

   [Service]
   User=your_user  # Замените на имя пользователя (например, "ubuntu")
   Group=www-data
   WorkingDirectory=/path/to/tradex  # Абсолютный путь к проекту
   ExecStart=/path/to/venv/bin/gunicorn -w 4 -b 0.0.0.0:5000 dashboard_app:app
   Restart=always
   EnvironmentFile=/path/to/tradex/.env

   [Install]
   WantedBy=multi-user.target
   ```

3. **Unit для `webhook_receiver`** (`webhook_app.service`):
   ```ini
   [Unit]
   Description=Gunicorn instance to serve TradeX Webhook
   After=network.target

   [Service]
   User=your_user
   Group=www-data
   WorkingDirectory=/path/to/tradex
   ExecStart=/path/to/venv/bin/gunicorn -w 2 -b 0.0.0.0:5005 webhook_receiver:app
   Restart=always
   EnvironmentFile=/path/to/tradex/.env

   [Install]
   WantedBy=multi-user.target
   ```

4. **Перезагрузите systemd и запустите сервисы**:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl start dashboard_app webhook_app
   sudo systemctl enable dashboard_app webhook_app
   ```

5. **Проверка статуса и логов**:
   ```bash
   sudo systemctl status dashboard_app
   sudo journalctl -u dashboard_app -f
   ```

---

## Использование Nginx как прокси для Webhooks

Нужно выставить webhook слушатель на порт `80` или `443`, используя Nginx как обратный прокси:

1. Установите Nginx:
   ```bash
   sudo apt update
   sudo apt install nginx
   ```

2. Создайте конфигурационный файл `/etc/nginx/sites-available/tradex-webhook`
   ```nginx
   server {
       listen 80;
       server_name your.domain.com;

       location /webhook {
           proxy_pass http://127.0.0.1:5005;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       }
   }
   ```

3. Включите конфигурацию и перезапустите Nginx:
   ```bash
   sudo ln -s /etc/nginx/sites-available/tradex-webhook /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

4. Обновите URL webhook в TradingView: `http://your.domain.com/webhook`.

---

## Устранение неполадок

- **Ошибка: "No exchanges loaded!"**: убедитесь, что API‑ключи заданы в `.env`.
- **Ошибки webhook**: проверьте, что `WEBHOOK_PIN` совпадает с `WEBHOOK_PIN` в `.env`.
- **Проблемы с Email Reader**: проверьте IMAP‑учётные данные и разрешения IMAP у почтового провайдера.
- **Панель не доступна**: удостоверьтесь, что Flask приложение запущено и порт `5000` открыт.

Для дополнительной информации смотрите логи в папке `logs/`.

---

## Рекомендации по безопасности

- **Ограничьте доступ** к панели, привяжите её к `127.0.0.1` или настройте firewall.
- **Регулярно меняйте API‑ключи** для уменьшения рисков.

---

## Известные проблемы

- **Binance Futures**: поддержка не полностью протестирована.
- **Парсинг Email**: текущая реализация ожидает сигналы в subject; изменение формата может вызвать ошибки.
- **Ограничения по rate limits**: высокочастотная торговля может привести к срабатыванию лимитов на биржах.

---

## Лицензия

Проект лицензирован под MIT License.


