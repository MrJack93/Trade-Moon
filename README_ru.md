# TradeX

**TradeX** — это современный веб-бот для автоматизации крипто-торговли на таких популярных биржах, как **Binance** и **Bybit**. Он интегрируется с **TradingView webhooks** и уведомлениями по электронной почте, что позволяет выполнять сделки в реальном времени на основе пользовательских сигналов. Система предоставляет защищённую и удобную панель управления для наблюдения за открытыми позициями, ожидающими ордерами и управления сделками.

**Ключевые возможности:**
- Поддержка нескольких бирж (Bybit, Binance).
- Защищённая аутентификация и PIN‑защита для выполнения сделок.
- Мониторинг в реальном времени открытых позиций и ожидающих ордеров.
- Поддержка получения сигналов как через webhook, так и по электронной почте.
- Контейнеризованное развёртывание через Docker.

---

## Содержание
- [Функции](#функции)
- [Скриншоты](#скриншоты)
- [Поддерживаемые биржи](#поддерживаемые-биржи)
- [Режимы работы](#режимы-работы)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Использование](#использование)
- [Запуск TradeX как сервиса](#запуск-tradex-кАк-сервиса)
- [Запуск TradeX в Docker](#запуск-tradex-в-docker)
- [Использование Nginx как прокси для Webhooks](#использование-nginx-как-прокси-для-webhooks)
- [Устранение неполадок](#устранение-неполадок)
- [Рекомендации по безопасности](#рекомендации-по-безопасности)
- [Известные проблемы](#известные-проблемы)
- [Лицензия](#лицензия)
- [Поддержать проект](#поддержать-проект)

---

## Функции
- **Поддержка нескольких бирж**: интеграция с **Bybit** и **Binance Futures**.
- **Управление ордерами**: отмена позиций и ордеров прямо из панели управления.
- **Мониторинг в реальном времени**: отображение всех активных и ожидающих ордеров в удобном интерфейсе.
- **Закрыть все позиции**: быстрое закрытие всех открытых позиций одной кнопкой.
- **Получение сигналов**: поддержка сигналов как через **webhook**, так и по **email**.
- **Аутентификация**: защищённая панель с паролем.
- **PIN‑защита**: дополнительный уровень безопасности — для выполнения ордеров требуется PIN для webhook/почты.
- **Логирование**: подробные логи для отладки и мониторинга.

---

## Скриншоты
![App_Screenshot](https://github.com/user-attachments/assets/79bd5123-c81c-49b1-9e8e-5d064698f20d)

---

## Поддерживаемые биржи

<img src="https://github.com/user-attachments/assets/ce33b5e5-0d4d-411e-9821-50e12414a7f2" alt="image" width="100px">   
<img src="https://github.com/user-attachments/assets/ab0da857-493e-4824-ab3e-0d87fb05a0b0" alt="image" width="100px">

- **Bybit Futures**
- **Binance Futures** (полностью не протестировано)
- Дополнительные биржи можно добавить по запросу или в PR.

---

## Режимы работы

TradeX поддерживает два режима приёма торговых сигналов: **Webhook Mode** и **Email Mode**. Эти режимы дают гибкость в зависимости от инфраструктуры и предпочтений. Режим настраивается через переменную окружения `MODE` в файле `.env` (`MODE=webhook`, `MODE=email` или `MODE=both`).

---

### 1. Webhook Mode

**Webhook Mode** позволяет TradeX принимать торговые сигналы в реальном времени через HTTP POST-запросы. Этот режим подходит для пользователей с публичным IP или доменом.

#### Основные особенности:
- **Выполнение в реальном времени**: сигналы обрабатываются сразу после получения.
- **Низкая задержка**: минимальная задержка между генерацией сигнала (например, в TradingView) и исполнением ордера.
- **Защита**: требуется настраиваемый PIN (`WEBHOOK_PIN`) для авторизации сигналов.
- **Интеграция с TradingView**: простая интеграция через webhooks.

#### Требования:
- Публичный IP-адрес или домен, указывающий на сервер.
- Стабильное подключение к интернету.
- Открытые порты `80` или `443` (или проксирование через Nginx/Apache).
- Опционально: SSL/TLS сертификат для HTTPS.

#### Сценарий использования:
Если у вас есть выделённый сервер или VPS с публичным IP и нужна максимальная скорость исполнения — выбирайте **Webhook Mode**. Он подходит трейдерам, которым важна быстрая реакция на рыночные события.

#### Важно:
TradingView webhooks не гарантируют доставку без задержек или ошибок. Ограничения включают:
- **Задержки доставки**: возможны из‑за высокой нагрузки.
- **Требования к скорости ответа**: TradingView ожидает быстрый ответ (обычно миллисекунды). Если приложение отвечает долго, TradingView может повторить запрос или пометить его как неуспешный.
- **Нет 100% гарантий доставки**.

Рассмотрите использование **Email Mode** как резервного варианта или включите **Dual Mode** (`MODE=both`) для надёжности.

---

### 2. Email Mode

**Email Mode** позволяет TradeX обрабатывать торговые сигналы, присылаемые по электронной почте. Этот режим удобен, если у вас нет публичного IP или вы предпочитаете не открывать порты.

#### Основные особенности:
- **Не требуется публичный IP**: всё работает через почту — не нужно пробрасывать порты.
- **Устойчивость к офлайну**: если соединение временно пропадает, письма будут ждать в ящике и обработаются позже.
- **Простая настройка**: достаточно настроить IMAP и отправлять сигналы по почте.
- **Гибкий формат сигналов**: сигналы можно помещать в subject письма в виде JSON.

#### Требования:
- Почтовый ящик с доступом по IMAP.
- Корректно отформатированные сигналы в subject (JSON).

#### Сценарий использования:
Если у вас нет публичного IP или стабильного соединения — **Email Mode** будет оптимальным вариантом. Также подходит как резерв в случае проблем с webhook.

---

### 3. Dual Mode (оба режима)

Для максимальной надёжности TradeX поддерживает **Dual Mode** (`MODE=both`), когда одновременно слушаются сигналы и по webhook, и по email.

#### Преимущества:
- **Универсальность**: сочетание скорости webhook и надёжности email.
- **Гибкость**: вебхуки для срочных сигналов, почта для гарантированных доставок.

#### Пример использования:
Трейдер использует **TradingView webhooks** для срочных сигналов во время активной торговли, а email — для ночных или менее срочных операций. Включив оба режима, можно минимизировать риск пропуска сигналов.

#### Важно:
При Dual Mode настройте отправку сигналов в TradingView аккуратно, чтобы избежать дублей:
- **Выберите «Send Email» только для менее срочных сигналов**.
- **Выберите «Webhook URL» только для срочных сигналов**.
- **Не включайте оба одновременно** для одного и того же сигнала — это приведёт к двойной отправке и потенциально к дублям ордеров.

TradeX в текущей версии не содержит механизма дедупликации, поэтому настройка на стороне TradingView остаётся на ответственности пользователя.

---

### Как настроить режим

Установите `MODE` в вашем `.env`:
- `MODE=webhook` — только webhook.
- `MODE=email` — только email.
- `MODE=both` — оба режима одновременно.

---

### Дополнительные заметки
- **Безопасность**: оба режима поддерживают PIN (`WEBHOOK_PIN`) для защиты от неавторизованных сигналов.
- **Тестирование**: тестируйте режимы локально перед продакшен‑развёртыванием.

---

## Установка

### Требования
- Python 3.8 или выше
- Менеджер пакетов `pip`
- API‑ключи для поддерживаемых бирж (Bybit, Binance)
- Docker (опционально)

### Шаги
1. **Клонировать репозиторий**:
   ```bash
   git clone https://github.com/Sentello/tradex.git
   cd tradex
   ```

2. **Создать виртуальное окружение** (рекомендуется):
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **Установить зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Настроить переменные окружения**:
   - Переименуйте `.env.example` в `.env` или создайте новый `.env`.
   - Добавьте API‑ключи бирж, пароль для панели, PIN для webhook и другие параметры.

5. **Запустить приложение локально**:
   ```bash
   python main.py
   ```

6. **Открыть панель управления**:
   - В браузере перейдите на `http://localhost:5000`.

---

## Конфигурация

В `.env` необходимо задать следующие переменные:

| Переменная             | Описание                                                                  |
|------------------------|---------------------------------------------------------------------------|
| `DASHBOARD_PASSWORD`   | Пароль для доступа к панели.                                              |
| `WEBHOOK_PIN`          | PIN для защиты webhook сигналов.                                          |
| `BYBIT_API_KEY`        | API ключ Bybit.                                                           |
| `BYBIT_API_SECRET`     | Секретный ключ Bybit.                                                     |
| `BINANCE_API_KEY`      | API ключ Binance.                                                         |
| `BINANCE_API_SECRET`   | Секретный ключ Binance.                                                   |
| `MODE`                 | Режим приёма сигналов: `"webhook"`, `"email"` или `"both"`.               |
| `IMAP_SERVER`          | Адрес IMAP сервера (например, `imap.gmail.com`).                          |
| `IMAP_PORT`            | Порт IMAP (обычно `993` для SSL).                                         |
| `IMAP_EMAIL`           | Почтовый адрес для приёма сигналов.                                       |
| `IMAP_PASSWORD`        | Пароль от почтового аккаунта.                                             |


---

## Использование

### Пример webhook (тестирование с `curl`)

Слушатель webhook работает на порту `5005`. Примеры запросов для тестирования:

#### Рыночный ордер (market)
```bash
curl -X POST http://localhost:5005/webhook \
-H "Content-Type: application/json" \
-d '{
    "PIN": "123456",
    "EXCHANGE": "bybit",
    "SYMBOL": "BTCUSDT",
    "SIDE": "buy",
    "ORDER_TYPE": "market",
    "QUANTITY": 0.01
}'
```

```bash
curl -X POST http://<server-ip>:5005/webhook -H "Content-Type: application/json" -d '{
    "PIN": "123456",
    "EXCHANGE": "bybit",
    "SYMBOL": "BTCUSDT",
    "SIDE": "sell",
    "ORDER_TYPE": "market",
    "QUANTITY": 0.001
}'
```

#### Лимитный ордер (limit)
```bash
curl -X POST http://localhost:5005/webhook \
-H "Content-Type: application/json" \
-d '{
    "PIN": "123456",
    "EXCHANGE": "binance",
    "SYMBOL": "ETHUSDT",
    "SIDE": "sell",
    "ORDER_TYPE": "limit",
    "QUANTITY": 0.5,
    "PRICE": 2000.50
}'
```
```bash
curl -X POST http://<server-ip>:5005/webhook -H "Content-Type: application/json" -d '{
    "PIN": "123456",
    "EXCHANGE": "bybit",
    "SYMBOL": "BTCUSDT",
    "SIDE": "buy",
    "ORDER_TYPE": "limit",
    "QUANTITY": 0.05,
    "PRICE": 91000
}'
```

#### Интеграция с TradingView
При настройке webhook в TradingView используйте шаблоны и правильно экранируйте плейсхолдеры:
```json
{
    "PIN": "123456",
    "EXCHANGE": "bybit",
    "SYMBOL": "BTCUSDT",
    "SIDE": "{{strategy.order.action}}",
    "ORDER_TYPE": "market",
    "QUANTITY": "{{strategy.order.contracts}}"
}
```

**Примечание**: TradingView отправляет webhooks на порты `80` или `443`. Рекомендуется использовать Nginx как обратный прокси, чтобы перенаправлять запросы на порт `5005`.

---

## Запуск TradeX как сервиса

TradeX можно запустить как сервис через **Supervisor** или **systemd**. Подробности см. в [HOWTO.md](HOWTO.md).

---

## Запуск TradeX в Docker

1. Сборка и запуск:
   ```bash
   docker-compose build --no-cache
   docker-compose up --build -d
   ```

   или используйте `build_and_run.sh`.

2. Проверить статусы контейнеров:
   ```bash
   docker ps | grep tradex
   ```

3. Просмотр логов:
   ```bash
   docker-compose logs -f
   ```

4. Остановить приложение:
   ```bash
   docker-compose down
   ```

---

## Использование Nginx как прокси для Webhooks

Нужно выставить webhook слушатель на порт `80` или `443`, используя Nginx как обратный прокси:

1. Установите Nginx:
   ```bash
   sudo apt update
   sudo apt install nginx
   ```

2. Создайте конфигурационный файл:
   ```bash
   sudo nano /etc/nginx/sites-available/tradex-webhook
   ```

3. Добавьте содержимое:
   ```nginx
   server {
       listen 80;
       server_name your.domain.com;

       location /webhook {
           proxy_pass http://127.0.0.1:5005;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

4. Включите конфигурацию и перезапустите Nginx:
   ```bash
   sudo ln -s /etc/nginx/sites-available/tradex-webhook /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

5. Обновите URL webhook в TradingView: `http://your.domain.com/webhook`.

---

## Устранение неполадок

- **Ошибка: "No exchanges loaded!"**: убедитесь, что API‑ключи заданы в `.env`.
- **Ошибки webhook**: проверьте, что `WEBHOOK_PIN` совпадает с `WEBHOOK_PIN` в `.env`.
- **Проблемы с Email Reader**: проверьте IMAP‑учётные данные и разрешения IMAP у почтового провайдера.
- **Панель не доступна**: удостоверьтесь, что Flask приложение запущено и порт `5000` открыт.

Для дополнительной информации смотрите логи в папке `logs/`.

---

## Рекомендации по безопасности

- **Ограничьте доступ** к панели, привяжите её к `127.0.0.1` или настройте firewall.
- **Регулярно меняйте API‑ключи** для уменьшения рисков.

---

## Известные проблемы

- **Binance Futures**: поддержка не полностью протестирована.
- **Парсинг Email**: текущая реализация ожидает сигналы в subject; изменение формата может вызвать ошибки.
- **Ограничения по rate limits**: высокочастотная торговля может привести к срабатыванию лимитов на биржах.

---

## Лицензия

Проект лицензирован под MIT License. Подробности — в файле [LICENSE](LICENSE).

---

## 🙏 Поддержать проект
Если проект оказался полезным и вы хотите поддержать автора, рассмотрите возможность доната.

### Сканировать для доната

#### Bitcoin (BTC SegWit)
`bc1qm4zv6fwxuf8n5sdkrfc6ylxyhs6vhmkkvxcjf0`

![image](https://github.com/user-attachments/assets/5476d500-b71a-4d4d-b688-6dcc35b2a858)


#### Ethereum (ETH ERC20)
`0xaa0ab64b0cdecb527eb5e7d5fc9ed94044c37a4c`

![image](https://github.com/user-attachments/assets/21981a90-50f2-46ef-aa29-7c68c9d1742b)


Спасибо!

---
<img src="https://media1.tenor.com/m/ofDuH0hvGh8AAAAd/so-what-do-you-think.gif" width="200" title="Ray Romano saying What do you think?" alt="Ray Romano saying What do you think?"/>
